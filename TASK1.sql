CREATE DATABASE TASK1;

CREATE TABLE CUSTOMERS(CUSTOMER_ID INT PRIMARY KEY,NAME VARCHAR(50),CITY VARCHAR(50));

CREATE TABLE PRODUCTS(PRODUCT_ID INT PRIMARY KEY,PRODUCT_NAME VARCHAR(50),CATEGORY VARCHAR(50),PRICE DECIMAL(10,2));

CREATE TABLE ORDERS(ORDER_ID INT PRIMARY KEY,CUSTOMER_ID INT,ORDER_DATE DATE,TOTAL_AMOUNT DECIMAL(10,2));

CREATE TABLE ORDER_ITEMS(ORDER_ITEM_ID INT PRIMARY KEY,ORDER_ID INT,PRODUCT_ID INT,QUANTITY INT);

INSERT INTO CUSTOMERS VALUES(1,'ARUN','SALEM'),(2,'PRIYA','CHENNAI'),(3,'KARTHIK','COIMBATORE'),(4,'DIVYA','MADURAI'),(5,'RAHUL','SALEM');

INSERT INTO PRODUCTS VALUES(101,'CHOCOLATE CAKE','CAKE',500),(102,'BROWNIE','BROWNIE',150),(103,'TEA CAKE','CAKE',300),(104,'CUPCAKE','CAKE',120),(105,'CHOCO LAVA','DESSERT',200);

INSERT INTO ORDERS VALUES(1001,1,'2026-01-01',650),(1002,2,'2026-01-02',500),(1003,1,'2026-01-05',300),(1004,3,'2026-01-07',900),(1005,5,'2026-01-10',450);

INSERT INTO ORDER_ITEMS VALUES(1,1001,102,2),(2,1001,104,1),(3,1002,101,1),(4,1003,103,1),(5,1004,101,1),(6,1004,105,2);

SELECT * FROM CUSTOMERS WHERE CITY='SALEM';

SELECT PRODUCT_NAME FROM PRODUCTS WHERE CATEGORY='CAKE';

SELECT * FROM ORDERS WHERE ORDER_DATE>'2026-01-05';

SELECT PRODUCT_NAME FROM PRODUCTS WHERE PRICE>200;

SELECT COUNT(CUSTOMER_ID) AS TOTAL_CUSTOMER FROM CUSTOMERS;

SELECT CUSTOMERS.NAME,ORDERS.ORDER_ID FROM CUSTOMERS JOIN ORDERS ON CUSTOMERS.CUSTOMER_ID=ORDERS.CUSTOMER_ID;

SELECT ORDERS.ORDER_ID,ORDERS.ORDER_DATE,ORDERS.TOTAL_AMOUNT,PRODUCTS.PRODUCT_NAME,ORDER_ITEMS.QUANTITY FROM ORDERS JOIN ORDER_ITEMS ON ORDER_ITEMS.ORDER_ID=ORDERS.ORDER_ID JOIN PRODUCTS ON PRODUCTS.PRODUCT_ID=ORDER_ITEMS.PRODUCT_ID;

ALTER TABLE PRODUCTS ADD CUSTOMER_ID INT;

UPDATE PRODUCTS SET CUSTOMER_ID = 1 WHERE PRODUCT_ID = 101;

UPDATE PRODUCTS SET CUSTOMER_ID = 2 WHERE PRODUCT_ID = 102;

UPDATE PRODUCTS SET CUSTOMER_ID = 3 WHERE PRODUCT_ID = 103;

UPDATE PRODUCTS SET CUSTOMER_ID = 4 WHERE PRODUCT_ID = 104;

UPDATE PRODUCTS SET CUSTOMER_ID = 5 WHERE PRODUCT_ID = 105; 

SELECT CUSTOMERS.NAME,PRODUCTS.PRODUCT_NAME,ORDERS.ORDER_DATE FROM CUSTOMERS JOIN PRODUCTS ON CUSTOMERS.CUSTOMER_ID=PRODUCTS.CUSTOMER_ID JOIN ORDERS ON ORDERS.CUSTOMER_ID=CUSTOMERS.CUSTOMER_ID;

SELECT SUM(ORDER_ITEMS.QUANTITY),PRODUCTS.PRODUCT_NAME FROM ORDER_ITEMS JOIN PRODUCTS ON ORDER_ITEMS.PRODUCT_ID=PRODUCTS.PRODUCT_ID GROUP BY PRODUCT_NAME ORDER BY QUANTITY;

SELECT SUM(ORDERS.TOTAL_AMOUNT),CUSTOMERS.NAME FROM CUSTOMERS JOIN ORDERS ON CUSTOMERS.CUSTOMER_ID=ORDERS.CUSTOMER_ID GROUP BY NAME ORDER BY TOTAL_AMOUNT; 

SELECT SUM(TOTAL_AMOUNT) AS TOTALSALES FROM ORDERS;

SELECT AVG(PRICE) AS AVGPRODUCTPRICE FROM PRODUCTS;

SELECT MAX(TOTAL_AMOUNT) AS HIGHEST_ORDER_AMOUNT FROM ORDERS;

SELECT COUNT(CUSTOMER_ID),CITY FROM CUSTOMERS GROUP BY CITY ORDER BY CUSTOMER_ID;

SELECT AVG(PRICE),CATEGORY FROM PRODUCTS GROUP BY CATEGORY ORDER BY PRICE;

SELECT CUSTOMER_ID FROM PRODUCTS WHERE PRICE>(SELECT AVG(PRICE) FROM PRODUCTS);

SELECT PRODUCT_NAME FROM PRODUCTS WHERE PRICE>(SELECT AVG(PRICE) FROM PRODUCTS);

SELECT CUSTOMER_ID,NAME FROM CUSTOMERS WHERE CUSTOMER_ID IN (SELECT CUSTOMER_ID FROM ORDERS GROUP BY CUSTOMER_ID HAVING COUNT(ORDER_ID)>1);

SELECT PRODUCT_NAME,PRICE FROM PRODUCTS WHERE PRICE=(SELECT MAX(PRICE) FROM PRODUCTS WHERE PRICE<(SELECT MAX(PRICE) FROM PRODUCTS));

SELECT CUSTOMER_ID,NAME FROM CUSTOMERS WHERE CUSTOMER_ID IN (SELECT CUSTOMER_ID FROM PRODUCTS WHERE PRODUCT_NAME = 'CHOCOLATE CAKE');

SELECT PRODUCTS.PRODUCT_NAME,SUM(ORDERS.TOTAL_AMOUNT) AS TOPSELLING ,ORDER_ITEMS.QUANTITY FROM PRODUCTS JOIN ORDER_ITEMS ON ORDER_ITEMS.PRODUCT_ID=PRODUCTS.PRODUCT_ID JOIN ORDERS ON ORDERS.ORDER_ID=ORDER_ITEMS.ORDER_ID GROUP BY PRODUCT_NAME ORDER BY TOPSELLING DESC LIMIT 1 ;

SELECT CUSTOMERS.CUSTOMER_ID,CUSTOMERS.NAME,SUM(ORDERS.TOTAL_AMOUNT) AS TOPSPENDING FROM CUSTOMERS JOIN ORDERS ON CUSTOMERS.CUSTOMER_ID=ORDERS.CUSTOMER_ID GROUP BY CUSTOMER_ID ORDER BY TOPSPENDING DESC LIMIT 1;

SELECT PRODUCTS.PRODUCT_ID,PRODUCTS.PRODUCT_NAME,ORDER_ITEMS.ORDER_ID,SUM(ORDER_ITEMS.QUANTITY) AS ORDERS FROM PRODUCTS JOIN ORDER_ITEMS ON PRODUCTS.PRODUCT_ID = ORDER_ITEMS.PRODUCT_ID GROUP BY ORDER_ID ORDER BY ORDERS LIMIT 1;

SELECT CUSTOMERS.NAME FROM CUSTOMERS LEFT OUTER JOIN ORDERS ON CUSTOMERS.CUSTOMER_ID = ORDERS.CUSTOMER_ID WHERE ORDER_ID IS NULL; 

SELECT * FROM ORDERS ORDER BY ORDER_DATE DESC LIMIT 1;

SELECT YEAR(ORDER_DATE) AS SALESYEAR , MONTH(ORDER_DATE) AS SALESMONTH , SUM(TOTAL_AMOUNT) AS TOTALSALES FROM ORDERS GROUP BY YEAR(ORDER_DATE),MONTH(ORDER_DATE) ORDER BY SALESYEAR,SALESMONTH;

SELECT ORDER_DATE,TOTAL_AMOUNT,SUM(TOTAL_AMOUNT) OVER (ORDER BY ORDER_DATE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS RUNNINGTOTAL FROM ORDERS ORDER BY ORDER_DATE;

ALTER TABLE ORDERS ADD PRODUCT_ID INT;

UPDATE ORDERS SET PRODUCT_ID = 101 WHERE ORDER_ID =1001;

UPDATE ORDERS SET PRODUCT_ID = 102 WHERE ORDER_ID =1002;

UPDATE ORDERS SET PRODUCT_ID = 103 WHERE ORDER_ID =1003;

UPDATE ORDERS SET PRODUCT_ID = 104 WHERE ORDER_ID =1004;

UPDATE ORDERS SET PRODUCT_ID = 105 WHERE ORDER_ID =1005;

SELECT PRODUCTS.PRODUCT_NAME,SUM(ORDERS.TOTAL_AMOUNT) AS PRODUCT_SALES ,ROUND(SUM(ORDERS.TOTAL_AMOUNT)*100.0 / SUM(SUM(ORDERS.TOTAL_AMOUNT)) OVER(),2) AS SALES_PERCENTAGE FROM PRODUCTS JOIN ORDERS ON PRODUCTS.PRODUCT_ID = ORDERS.PRODUCT_ID GROUP BY PRODUCTS.PRODUCT_NAME ORDER BY SALES_PERCENTAGE DESC;

SELECT CUSTOMERS.CUSTOMER_ID,CUSTOMERS.NAME,COUNT(DISTINCT ORDERS.PRODUCT_ID) AS PRODUCT_COUNT FROM CUSTOMERS JOIN ORDERS ON CUSTOMERS.CUSTOMER_ID = ORDERS.CUSTOMER_ID GROUP BY CUSTOMERS.CUSTOMER_ID HAVING COUNT(DISTINCT ORDERS.PRODUCT_ID)>1;

SELECT * FROM ORDERS;

SELECT PRODUCTS.PRODUCT_ID,PRODUCTS.PRODUCT_NAME,COUNT(DISTINCT ORDERS.ORDER_ID) AS TOTALORDERS FROM PRODUCTS JOIN ORDERS ON PRODUCTS.PRODUCT_ID = ORDERS.PRODUCT_ID GROUP BY PRODUCT_ID,PRODUCT_NAME HAVING (TOTALORDERS)>1;

